[{"path":"index.html","id":"введение","chapter":"Введение","heading":"Введение","text":"","code":""},{"path":"index.html","id":"о-курсе","chapter":"Введение","heading":"О курсе","text":"Моё знакомство с языком R состоялось в 2016 году. На тот момент я планировал его использовать для сбора данных по API из различных рекламных платформ. Для части из этих платформ я нашел готовые решения в видео пакетов, но для некоторых, менее известных рекламных площадок готов пакетов не оказалось. И тогда я попробовал разобраться самостоятельно с тем, как устроены R пакеты. На тот момент я не нашел полноценного гайда, и создавал пакеты методом тыка, используя встроенный в базовую комплектацию R функционал, вроде функции package.skeleton(), далее я руками правил все .Rmd файлы, из которых генерируется докуметация к функциям, и вообще делал в ходе разработки пакетов очень много лишней работы.На данный момент в главном репозитории хранения R пакетов - CRAN уже опубликовано 14 разработанных мной пакетов, за годы разработки пакетов я уже набил довлльно много шишек, и ознакомился с замечательной книгой Хедли Викхема \"R Packages (2e)\", которая и легла в основу этого курса. Тем не менее данный курс не является полным повторением книги, некоторые главы мы рассматривать не будем, но и в ходе курса будут рассмотрены некоторые темы, которые Хедли не упоминал в своей книге.Разработка пакетов один из лучших способов повысить свои навыки написания кода на R, и углуюиться в его изучение. Данный курс поможет вам пошагово освоить процесс разработки собственных пакетов. К тому же таким образом вы сможете внести свой вклад в развитие языка поделившись своими наработками, упакованными в R пакет.Добро пожаловать на курс \"Разработка пакетов на языке R\", и успехов в его прохождении!","code":""},{"path":"index.html","id":"для-кого-этот-курс","chapter":"Введение","heading":"Для кого этот курс","text":"Данный курс я не могу рекомендовать новичкам. Заниматься разработкой пакетов лучше имея за плечами определённый опыт написания кода на R. Поэтому не стоит начинать изучения R с данного курса, ниже я дам небольшую подборку подготовительных курсов, изучив которые можно попробовать себя в разработке пакетов.","code":""},{"path":"index.html","id":"по-поводу-поддержки-обучающихся-на-данном-курса","chapter":"Введение","heading":"По поводу поддержки обучающихся на данном курса","text":"Важно! Поддержки учащихся на этом курсе со стороны автора нет. Я не занимаюсь частными консультациями, тем более не консультирую студентов бесплатных курсов. Поэтому не имеет никакого смысла писать мне в личку или на почту просьбы помочь с прохождением этого, или любого другого моего бесплатного курса. Если вы столкнулись с трудностями при прохождении курса и вам нужна помощь, то все вопросы можно адресовать в следующие telegram чаты:R (язык программирования)Горячая линия RОтдельного чата со студентами непосредственно этого курса не существует, но при желании вы самостоятельно можете его организовать, и я с радостью добавлю на него ссылку.К тому же, если у вас есть вопросы по одной из лекций курса, вы можете задавать его под видео лекции на YouTube, это приветствуется, и на такие комментарии я с радостью отвечу.Буду рад любой конструктивной критике, и предложениям по улучшению курса \"разработка пакетов на языке R\", направлять их можно мне на почту selesnow@gmail.com. Если вы хотите выразить благодарность мне за курс, то в конце раздела описано как это можно сделать.","code":""},{"path":"index.html","id":"об-авторе","chapter":"Введение","heading":"Об авторе","text":"Меня зовут Алексей Селезнёв, с 2008 года я являюсь практикующим аналитиком. На данный момент основной моей деятельностью является развитие отдела аналитики в агентстве интернет-маркетинга Netpeak.\nМною были разработаны такие R пакеты как: rgoogleads, rfacebookstat, timeperiodsR и некоторые другие. На данный момент написанные мной пакеты только с CRAN были установленны более 200 000 раз.Также я являюсь автором некоторых других курсов по R (ссылки на них приведу ниже), лектором академии Web Promo Experts и соавтором курса \"Веб-аналитика Pro\".Веду свой авторский Telegram и YouTube канал R4marketing. Буду рад видеть вас в рядах подписчиков.Периодически публикую статью на различных интернет медиа, зачастую это Хабр и Netpeak Journal.Неоднократно выступал на профильных конференциях по аналитике и интернет маркетингу, среди которых Матемаркетинг, GoAnalytics, Analyze, eCommerce, 8P и прочие.","code":""},{"path":"index.html","id":"другие-курсы-автора","chapter":"Введение","heading":"Другие курсы автора","text":"Как я уже писал выше, помимо курса \"Разработка пакетов на языке R\" у меня есть ряд других бесплатных курсов:Язык R для интернет маркетинга, для начинающих, требуется бесплатная регистрацияЯзык R для пользователей Excel, для начинающихВведение в dplyr 1.0.0, средней уровень сложностиЦиклы и функционалы в языке R, средней уровень сложностиРазработка telegram ботов на языке R, высокий уровень сложности","code":""},{"path":"index.html","id":"каналы-автора","chapter":"Введение","heading":"Каналы автора","text":"Если вы интересуетесь языком R, применяете его в работе, или планируете изучать, то думаю вам будут интересны мои каналы, о которых я писал выше. Буду рад видеть вас среди подписчиков:Telegram канал R4marketingYoutube канал R4marketing","code":""},{"path":"index.html","id":"программа-курса","chapter":"Введение","heading":"Программа курса","text":"В данный момент курс \"разработка пакетов на языке R\" назодится в активной стадии разработки, поэтому программа постоянно расширяется, следить за обновлениями курса можно на страницк Новости курса. Ниже представлена актуальная программа на текущий момент:Обзор рабочего процесса разработки пакетаНастройка системы и интеграция с GitHubРекомендации по организации R кодаДобавление данных в пакетDESCRIPTION - Метаданные пакетаNAMESPACE - Зависимости пакетаРазработка юнит-тестов к функциям пакета (пакет testthat)Написание документации к функциям пакетаВиньетки и прочая опциональная документация пакетаРазработка сайта пакета (пакет pkgdown)Публикация в CRANРазработка пакета обёртки над API (пакет httr2)Разработка пакета обёртки для Google API (пакет gargle)Как создать коллекцию пакетовДата обновления курса: 14.09.2023","code":""},{"path":"index.html","id":"благодарности-автору","chapter":"Введение","heading":"Благодарности автору","text":"Курс, и все сопутствующие материалы предоставляются бесплатно, но если у вас есть желание отблагодарить автора за этот видео курс вы можете перечислить любую произвольную сумму на этой странице.Так же вы можете поделиться ссылкой на курс у себя в соц сетях, за что я тоже буду вам благдарен!facebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"обзор-рабочего-процесса-разработки-пакета","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"Урок 1 Обзор рабочего процесса разработки пакета","text":"В этом уроке мы поверхностно разберём весь процесс разработки пакета.Если вы работаете на Windows предварительно устновите Rtools.Данный урок основан на главе \"Whole Game\" книги \"R Packages (2e)\", под авторством Хедли Викхема и Дженни Брайан.","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"видео","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"1.1 Видео","text":"","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"тайм-коды","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"1.1.1 Тайм коды","text":"00:00 Вступление\n00:43 Как создать проект пакета\n01:50 Структура проекта пакета\n02:47 Добавляем проекту контроль версий\n03:14 Как добавить функцию в свой пакет\n04:17 Как загрузить текущий пакет (load_all())\n05:05 Как запустить проверку пакета (check())\n05:56 Файл DESCRIPTION\n06:52 Добавляем лицензию пакету\n07:08 Добавляем документацию к функциям пакета\n09:47 Файл NAMESPACE\n10:10 Добавляем юнит тесты для функций пакета\n13:34 Как использовать в своём пакете функции из других пакетов\n16:46 Обзор всего рабочего процесса\n19:03 Заключение","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"презентация","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"1.2 Презентация","text":"","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"конспект","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"1.3 Конспект","text":"","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"вспомогательные-пакеты","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"1.3.1 Вспомогательные пакеты","text":"devtools - инструменты разработчика пакетаusethis - автоматизация настройки разрабатываемого пакетаtestthat - разработка юнит тестов к функциям пакетаroxygen2 - упрощённое написание документации к функциям пакета","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"процесс-разработки-пакета","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"1.3.2 Процесс разработки пакета","text":"Создаём проект пакета с помощью команды create_package()Включаем контроль версий с помощью функции use_git()Добавляем лицензию командой use_mit_licence()Добавляем в пакет функции с помощью команды use_r()Документируем созданные функции добавляя специализированиы комментарии сочетанием клавиш Ctrl+Alt+Shift+Rгенерируем файлы документации функций командой document()Для тестирования добавляем в файл DESCRIPTION пакет testthat командой use_testthat()Добавляем для каждой функции юнит тесты командой use_test()Запускаем тестирование функций командой test()Для использования функций из стороних пакетов добавляем их в блок Imports файлв DESCRIPTION командой use_package(), в коде используем импортированные функции с помощью package_name::function_name()Проверяем пакет командой check()","code":""},{"path":"обзор-рабочего-процесса-разработки-пакета.html","id":"тест","chapter":"Урок 1 Обзор рабочего процесса разработки пакета","heading":"1.4 Тест","text":"facebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""},{"path":"настройка-системы-и-интеграция-с-github.html","id":"настройка-системы-и-интеграция-с-github","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"Урок 2 Настройка системы и интеграция с GitHub","text":"Данный урок посвящён настройке вашей операционной системы и среды для разработки пакетов. Мы установим всё необходимое программное обеспечение, зарегистрируем бесплатный аккаунт на GitHub и настроим интеграцию между RStudio и GitHub.Данный урок основан на главе \"System setup\" книги \"R Packages (2e)\", под авторством Хедли Викхема и Дженни Брайан. А так же \"usethis setup\", входящую в документацию пакета usethis.","code":""},{"path":"настройка-системы-и-интеграция-с-github.html","id":"видео-1","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.1 Видео","text":"","code":""},{"path":"настройка-системы-и-интеграция-с-github.html","id":"тайм-коды-1","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.1.1 Тайм коды","text":"00:00 Вступление\n00:50 Настройка дефолтных опций пакета usethis\n05:13 Установка утилиты rtools\n06:38 Регистрация на GitHub\n08:15 Установка Git\n09:53 Установка учётных данных в Git\n11:27 Создание персонального токена на GitHub\n15:04 Проверяем систему на готовность к компиляции пакетов\n15:40 Отправка пакета из RStudio на GitHub\n17:25 Обзор всего процесса настройки системы для разработки пакетов и интеграции RStudio с GitHub\n18:43 Заключение","code":""},{"path":"настройка-системы-и-интеграция-с-github.html","id":"презентация-1","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.2 Презентация","text":"","code":""},{"path":"настройка-системы-и-интеграция-с-github.html","id":"конспект-1","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.3 Конспект","text":"Для настройки системы и интеграции с GitHub скачайте и установите следующее программное обеспечение:Rtools - Специальная утилита для сборки пакетов на Windows (только если работаете на Windows).Git - система управления версиями с распределенной архитектурой.","code":""},{"path":"настройка-системы-и-интеграция-с-github.html","id":"настройка-дефорлтных-опций-пакета-usethis","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.3.1 Настройка дефорлтных опций пакета usethis","text":"Для удобства вы можете настроить некоторые опции пакета usethis по умолчанию, например есть смысл проставлять по умолчанию в файле DESCRIPTION вас как автора пакета.Некоторые опции usethis:usethis.description - именованный список полей DESCRIPTION по умолчанию для новых пакетов, созданных с помощью usethis::create_package()usethis.full_name – задаёт имя по умолчанию, которое будет использоваться например при создании файла лицензииusethis.quiet – запрещает usethis выводить сообщения в консольusethis.destdir - каталог по умолчанию для использования в create_from_github()и use_course()Наиболее простой способ задать опции - отредактироваьт глобальный файл .Rprofile, выполните команду usethis::edit_r_profile(), после чего в RStudio откроется .Rprofile, далее добавьте в него код определния нудных опций:Теперь при создании пакета с помощью команды usethis::create_package() файле DESCRIPTION автоматически будет заполняться поле с указанием автора пакета.","code":"\noptions(\n  usethis.description = list(\n    \"Authors@R\" = utils::person(\n      \"Alexey\", \"Seleznev\",\n      email = \"selesnow@gmail.com\",\n      role = c(\"aut\", \"cre\"),\n      comment = c(ORCID = \"0000-0003-0410-7385\")\n    )\n  ),\n  usethis.destdir = \"C:/Users/SAMSUNG/Documents\",\n  usethis.overwrite = TRUE\n)"},{"path":"настройка-системы-и-интеграция-с-github.html","id":"настройка-системы","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.3.2 Настройка системы","text":"Скачайте и установите Rtools, если работаете на WindowsСкачайте и установите GitПерезагрузите системуУстановите учётные данные для Git","code":"\nlibrary(usethis)\n\n# подключаем Git\nuse_git()\n\n# имя для Git вы можете задать любое, им будут подписываться коммиты\n# email должен быть связан с учётной записью GitHub\nuse_git_config(user.name = \"Your Name\", user.email = \"your@gmail.com\")\n\n# проверка настроек\ngit_sitrep()"},{"path":"настройка-системы-и-интеграция-с-github.html","id":"интеграция-rstudio-с-github","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.3.3 Интеграция RStudio с GitHub","text":"Зарегистрируйте бесплатный аккаунт на GithubСоздайте персональный токен на GitHubДобавьте созданный токен в хранилище учётных данныхОпубликуйте проект вашего пакета на GitHub","code":"\n# получаем токен GitHub\nusethis::create_github_token()\n\n# добавляем токен в хранилище учётных данных\ngitcreds::gitcreds_set()\n\n# пуьбликуем проект пакета\nusethis::use_github()"},{"path":"настройка-системы-и-интеграция-с-github.html","id":"задание","chapter":"Урок 2 Настройка системы и интеграция с GitHub","heading":"2.4 Задание","text":"В этом уроке вместо теста у нас будет задание:Устновите rtools (только если работаете на Windows)Устновите GitЗарегистрируйте бесплатный аккаунт на Github (если его у вас ещё нет)Настройте интеграцию RStudio с GitHubСоздайте проект будущего пакетаОпубликуйте его на Githubfacebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"рекомендации-по-организации-r-кода","chapter":"Урок 3 Рекомендации по организации R кода","heading":"Урок 3 Рекомендации по организации R кода","text":"В этом уроке мы разберёмся с базовыми рекомендациями по организации кода вашего пакета, а так же узнаем чем принципиально отличается разработка пакета от написания обычного R сценария.Данный урок основан на главе \"R code\" книги \"R Packages (2e)\", под авторством Хедли Викхема и Дженни Брайан.","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"видео-2","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.1 Видео","text":"","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"тайм-коды-2","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.1.1 Тайм коды","text":"00:00 Вступление\n00:44 Из каких компонентов состоит пакет\n01:07 Как организовать функции пакета в файлы\n03:55 Про функции library() и source() в коде пакет\n05:32 Не изменяйте настройки глобальной среды R: функция .exit() и пакет withr\n14:09 Как задать локальные опции пакета, функция .onLoad()\n17:10 Код пакета определённый вне функций\n18:20 Заключение","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"презентация-2","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.2 Презентация","text":"","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"конспект-2","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3 Конспект","text":"","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"организация-функций-в-файлы","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3.1 Организация функций в файлы","text":"По поводу организаций функций в файлы нет строгих правил, есть два крайних подхода:Поместить каждую функцию в отдельный R файлПоместить код всех функций в один R файлОба этих подхода далеки от лучших практик, и затрудняют навигацию по коду пакета, поэтому для организации функций придерживайтесь следубщих правил:Если у вас есть семейство функций поместите их в один R файлЕсли у вас есть функция и набор вспомогательных к ней функций, поместите основную функцию и её помощников в один R файлЕсли функция не имеет помощников, и не входит ни в какое семейство функций, поместите её отдельно в R файл","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"команды-library-и-source","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3.2 Команды library() и source()","text":"Никогда не используйте в коде пакета команды library(), require() и source():library() и require() изменяют путь поиска, влияя на то, какие функции доступны из глобальной среды. Вместо этого вы должны использовать DESCRIPTION для указания требований вашего пакета. Это также гарантирует, что эти пакеты будут установлены при установке вашего пакета.source() изменяет текущую среду, вставляя результаты выполнения кода. Для использования добавленных функций в ваш пакет используйте load_all() или test().","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"пакет-не-должен-изменять-настройки-глобального-окружения-r","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3.3 Пакет не должен изменять настройки глобального окружения R","text":"Фукнции вашего пакета не должны изменять глобальных настроек, т.е. опций, переменных среды, счётчика генерации случайных чисел, и т.д. глобальной среды R. Поэтому старайтесь избегать, или использовать с крайней осторожностью такие команды как:options()par()setwd()Sys.setenv()Sys.setlocale()set.seed()Если вам всё таки необходимо внутри функций вашего пакета переопределять состояние среды, делайте это так, что бы при выходе из функции все переопределённые опции возвращались к исходному значению. Сделать это можно с помощью:Базовой функции .exit()Функционала пакета withr","code":""},{"path":"рекомендации-по-организации-r-кода.html","id":"пример-неправильного-определения-опций-пакета","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3.3.1 Пример неправильного определения опций пакета:","text":"Функция f1() в своём коде переопределяет значение опции test.opt, до запуска функции данная опция имела значение 10, функция, незаметно для её пользователя, изменила это значение на 15 в глобальной среде. Это может вызвать проблемы, если данная опция используется шде-то далее в вашем коде, при чём обнаружиь такую проблему зачастую довольно сложно.","code":"\n# Неправильная установка опций --------------------------------------------\n## определяем какую то опцию в рамках сеанса\noptions(test.opt = 10)\n## запрашиваем значение опции\ngetOption('test.opt')\n#> [1] 10\n\n# определяем функцию изменяющую значение опции\nf1 <- function(x) {\n\n  options(test.opt = x)\n  getOption('test.opt')\n\n}\n\n## запускаем функцию\nf1(15)\n#> [1] 15\n## работа функции изменила значение опции, определённое в глобальной среде\ngetOption('test.opt')\n#> [1] 15"},{"path":"рекомендации-по-организации-r-кода.html","id":"пример-локального-изменения-опция-с-помощью-функции-on.exit","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3.3.2 Пример локального изменения опция с помощью функции on.exit():","text":"В функции f2() мы добавили конструкцию old <- options(test.opt = x), которая созраняет прежнее значение опции перед тем, как присвоить новое. Далее с помощью функции .exit(options(old)) мы говорим нашей фукнции вернуть исходное значение заданой внутри функции опции test.opt. Как видим, теперь функция не изменяет значение опции в глобальной среде, заданное изменение действует только внутри функции.","code":"\n# базовая конструкция on.exit() -------------------------------------------\n## возвращаем дефолтное значение опции\noptions(test.opt = 10)\n\n## пишем код функции, работающий с опцией локально\nf2 <- function(x) {\n\n  old <- options(test.opt = x)\n  on.exit(options(old))\n  getOption('test.opt')\n\n}\n\n# запускаем функцию\nf2(15)\n#> [1] 15\n# проверяем значение опции после её выполнения\ngetOption('test.opt')\n#> [1] 10"},{"path":"рекомендации-по-организации-r-кода.html","id":"пример-изменения-опции-с-помощью-функционала-пакета-withr","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3.3.3 Пример изменения опции с помощью функционала пакета withr:","text":"Пакет withr предоставляет более гибкий функционал для локального изменения значений опций.\nПример изменения опций с помощью функции with_options():При использовании функций с префиксом with_*() область действия изменений внесённых в опции или переменные среды распространяется только на код, прописанный в качестве второго аргумента самой функций. Поэтому внутри функции f3() изначально значение опции test.opt равно 10, после внутри функции with_options() мы его меняем на 15, после выхода из функции with_options() опция test.opt опять имеет глобально определённое значение 10, не смотря на то, что мы ещё не вышли из основной функции f3().Пример изменения опций с помощью функции with_local():Функции с префиксом local_*() определяют изменения среды, которые действуют внутри вашей функции, т.е. так же как и базовая функция .exit().","code":"\n# установка опций с помощью withr -----------------------------------------\n## определяем какую то опцию в рамках сеанса\noptions(test.opt = 10)\n## запрашиваем значение опции\ngetOption('test.opt')\n#> [1] 10\n\n## with_*() - функции лучше всего подходят для выполнения небольших фрагментов кода с временно измененным состоянием.\nf3 <- function(x) {\n\n  print(getOption('test.opt'))\n\n  withr::with_options(\n    list(test.opt = x),\n    print(getOption('test.opt'))\n  )\n\n  print(getOption('test.opt'))\n\n}\n\n# запускаем функцию\nf3(15)\n#> [1] 10\n#> [1] 15\n#> [1] 10\n## запрашиваем значение опции\ngetOption('test.opt')\n#> [1] 10\n## local_*() - функции определяют значения опций, которые будут действоваьт до выхода из функции.\n\nf4 <- function(x) {\n\n  print(getOption('test.opt'))\n  withr::local_options(list(test.opt = x))\n  print(getOption('test.opt'))\n\n}\n\n# запускаем функцию\nf4(15)\n#> [1] 10\n#> [1] 15\n## запрашиваем значение опции\ngetOption('test.opt')\n#> [1] 10"},{"path":"рекомендации-по-организации-r-кода.html","id":"как-задать-локальные-опции-своего-пакета","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.3.4 Как задать локальные опции своего пакета","text":"Иногда вам может понадобиться определить внутренние опции, ищменяющие поведение вашего пакета. Код определния опций следует прописывать внутри специальной функции .onLoad(). Данная функция выполняется каждый раз при загрузке пакета в память, т.е. при выполнении команды library(package_name). Код определения функций пакета принято помещать в файл zzz.R, делается это для того, что бы данный фрагмент кода пакета выполнялся в последнюю очередь.Так же важно придерживаться описанного выше правила, не менять значения опций глобального окружения, поэтому название опций пакета следует задавать согласно шаблону package_name.option_name. Перед тем, как определить значение опций пакета убедитесь, что пользовал не установил их значения до подключения самого пакета, что бы не изменить их значения незаметно для конечного пользователя вашего пакета.Пример очень урезанного кода определения внутренних опций пакета dplyr:Что делает приведённый выше код:Изначально командой op <- options() мы считываем все опции определённые в глобальном окруженииДалее мы задаём список (package_name.op) опций нашего пакета, именуя опции согласно шаблону package_name.option_nameКоманда toset <- !(names(op.dplyr) %% names(op)) проверяет - небыли ли установлены глобально значения каких либо опций нашего пакетаЕсли хотя бы одна из опций пакета не имеет значений в глобальном окружении (((toset))) то устанавливаем для неопределнных опций дефолтные значения (options(op.dplyr[toset])).","code":"\n.onLoad <- function(libname, pkgname) {\n  op <- options()\n  op.dplyr <- list(\n    dplyr.show_progress = TRUE\n  )\n  toset <- !(names(op.dplyr) %in% names(op))\n  if (any(toset)) options(op.dplyr[toset])\n\n  invisible()\n}"},{"path":"рекомендации-по-организации-r-кода.html","id":"тест-1","chapter":"Урок 3 Рекомендации по организации R кода","heading":"3.4 Тест","text":"facebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""},{"path":"добавление-данных-в-пакет.html","id":"добавление-данных-в-пакет","chapter":"Урок 4 Добавление данных в пакет","heading":"Урок 4 Добавление данных в пакет","text":"В этом уроке мы разберёмся с тем для чего вам может понадобиться добавить в ваш пакет помимо кода функций ещё и данные, и рассмотрим 5 способов это сделать.Данный урок основан на главе \"Data\" книги \"R Packages (2e)\", под авторством Хедли Викхема и Дженни Брайан.","code":""},{"path":"добавление-данных-в-пакет.html","id":"видео-3","chapter":"Урок 4 Добавление данных в пакет","heading":"4.1 Видео","text":"","code":""},{"path":"добавление-данных-в-пакет.html","id":"тайм-коды-3","chapter":"Урок 4 Добавление данных в пакет","heading":"4.1.1 Тайм коды","text":"00:00 Введение\n00:35 Зачем добавлять данные в пакет\n02:08 Экспортируемые данные\n05:20 Внутренние данные пакета\n07:57 Необработанные данные\n13:51 Состояние пакета (внутренняя среда пакета)\n16:30 Постоянные пользовательские данные\n18:30 Прочие каталоги пакета\n19:33 Заключение","code":""},{"path":"добавление-данных-в-пакет.html","id":"презентация-3","chapter":"Урок 4 Добавление данных в пакет","heading":"4.2 Презентация","text":"","code":""},{"path":"добавление-данных-в-пакет.html","id":"конспект-3","chapter":"Урок 4 Добавление данных в пакет","heading":"4.3 Конспект","text":"","code":""},{"path":"добавление-данных-в-пакет.html","id":"какие-типы-данных-можно-добавить-в-пакет","chapter":"Урок 4 Добавление данных в пакет","heading":"4.3.1 Какие типы данных можно добавить в пакет","text":"Есть 5 способов добавления данных в ваш пакет, в зависимости от того, как эти данные далее будут использоваться:Экспортируемые данныеВнутренние данныеНеобработанные данныеСреда пакетаПостоянные пользовательские данные","code":""},{"path":"добавление-данных-в-пакет.html","id":"экспортируемые-данные","chapter":"Урок 4 Добавление данных в пакет","heading":"4.3.2 Экспортируемые данные","text":"Это данные, которые экспорптируются при подключении пакета, и подразумевают их дальнейшее использование конечными пользователями вашего пакета. Зачастую в пакет добавляют несколько наборов данных, которые используются в примерах использования функционала пакета, иногда встречаются пакеты, которые состоят исключительно из данных.Экспортируемые данные хнятся в виде .rda файлов в специальном каталоге data/. Наиболее простой способ включить экспортируемые данные в ваш пакет предоставляет функция usethis::use_data().Функция usethis::use_data() выполняет следующее:Создаёт каталогdata/, если его ещё нетДобавляет в каталог data/ .rda файлыДобавляет блок LazyData: true в DESCRIPTION файлНе смотря на то, что у вас есть возможность созранить любе количество наборов данных в один .rda файл рекомендуется под каждый экспортируемый набор данных создавать отдельный файл в папке data/.","code":"\n# создаём набор данных\nboard_of_directors <- tibble::tibble(\n  id            = 1:5,\n  name          = c(\"Alex\", \"John\", \"Bill\", \"Stiv\", \"Michael\"),\n  position      = c(\"CEO\", \"CTO\", \"CMO\", \"CDO\", \"CFO\"),\n  department    = rep(\"Board of Directors\", 5),\n  year_of_birth = c(1984, 1971, 1987, 1980, 1978),\n  rate          = c(5000, 4200, 3500, 4500, 3500),\n  office        = c(\"New York\", \"New York\", \"Chicago\", \"Washington\", \"Washington\")\n)\n\n# сохраняем его в каталог data\nusethis::use_data(board_of_directors)"},{"path":"добавление-данных-в-пакет.html","id":"внутренние-данные","chapter":"Урок 4 Добавление данных в пакет","heading":"4.3.3 Внутренние данные","text":"Данные, которые используются искобчительно функциями вашего пакета, являются исключительно технической, а не функциональнйо частью вашего пакета, и для конечного пользователя эти данные недоступны. Соответвенно внутренние данные не экспортируются при подключения пакета. Такие данные хрантся в специальном файле sysdata.rda в каталоге R/, т.е. вместе с кодом функций пакета.Добавить в пакет внутренние данные можно той же функцией usethis::use_data(), но указав значение аргумента internal = TRUE.В отличае от экспортируемых данных, все внутренние наборы данных помещаются в один файл sysdata.rda, поэтому все их необходимо одновременно указать в функции usethis::use_data().","code":"\n# создаём наборы данных\nboard_of_directors <- tibble::tibble(\n  id            = 1:5,\n  name          = c(\"Alex\", \"John\", \"Bill\", \"Stiv\", \"Michael\"),\n  position      = c(\"CEO\", \"CTO\", \"CMO\", \"CDO\", \"CFO\"),\n  department    = rep(\"Board of Directors\", 5),\n  year_of_birth = c(1984, 1971, 1987, 1980, 1978),\n  rate          = c(5000, 4200, 3500, 4500, 3500),\n  office        = c(\"New York\", \"New York\", \"Chicago\", \"Washington\", \"Washington\")\n)\n\noffice_coef <- tibble::tibble(\n  office = c(\"New York\", \"Chicago\", \"Washington\"),\n  coef   = c(1.2, 0.85, 1.1)\n)\n\n# сохраняем его в файл R/sysdata.rda\nusethis::use_data(board_of_directors, office_coef, internal = T)"},{"path":"добавление-данных-в-пакет.html","id":"необработанные-данные","chapter":"Урок 4 Добавление данных в пакет","heading":"4.3.4 Необработанные данные","text":"Такие данные могут использоваться для предоставления тестовых данных, для примеров использования функций пакета. Например, в пакет readxl, предназначенный для чтения данных из Excel книг, включены несколько Excel книг, исключительно для того, что бы пользователи могли протестировать его работу, описанную в примерах к функциям пакета.Необработанные данные необходимо хранить в специальном каталоге по пути inst/extdata, т.е. создаёте каталог inst, и внутри него подкаталог extdata.Далее в эту папку добавляете файлы с данными.для обращения к добавленным необработанным данным необходимо использовать функцию system.file(), но тут есть один нюанс. Дело в том, что ваш пакет может иметь разные состояни. в момент разработки это просто проект, который может находится в любом месте на вашем жестком диске, а функция system.file() ищет файлы исключительно в уже установленных пакетах, и если вы её просто будете использовать в вашем пакете, она вернёт пустую строку, вместо пути к файлу с необработанными данными. Но, как вы помните команда load_all() имитирует процесс загрузки вашего разрабатываемого пакета в память. очень близко к тому, как это делает команда library() с уже установленными пакетами. Поэтому, для того, что бы команда system.file() успешно работала в момент разработки вашего пакета, вам всегда необходимо держать пакет в состоянии загруженном в память, т.е. до того, как вы будете тестировать ваши функции нажмите сочетание клавиш Ctrl + Shift + L.","code":"\ndir.create('inst/extdata', recursive = T)\n# Пример обращения к сырым данным пакета firstpackage\n# предварительно обязательно надо загрузить пакет в память через load_all()\nsystem.file('extdata', 'board_of_directors.csv', package = 'firstpackage')"},{"path":"добавление-данных-в-пакет.html","id":"среда-пакета","chapter":"Урок 4 Добавление данных в пакет","heading":"4.3.5 Среда пакета","text":"Данный приём используется если вам необходимо динамически изменять состояние вашего пакета. В таком случае вам необходимо создать внутри пакета отдельную среду, добавьте файл aaa.R в каталог R/, в котором создайте пустую среду, и добавльте в неё нужные объекты:Далее в случае необходимости обращения, или изменения значений созданных внутри среды объектов добавьте специальные функции:Код заимствован из книги \"R Packages 2e\", Hadley Wickham, глава Data, раздел Internal stateТакие данные могут динамически изменяться в ходе одного R сеанса, но при повторном сеансе будут стартовать со своих исходных значений.","code":"\nthe <- new.env(parent = emptyenv())\nthe$favorite_letters <- letters[1:3]\n#' Report my favorite letters\n#' @export\nmfl2 <- function() {\n  the$favorite_letters\n}\n\n#' Change my favorite letters\n#' @export\nset_mfl2 <- function(l = letters[24:26]) {\n  old <- the$favorite_letters\n  the$favorite_letters <- l\n  invisible(old)\n}"},{"path":"добавление-данных-в-пакет.html","id":"постоянные-пользовательские-данные","chapter":"Урок 4 Добавление данных в пакет","heading":"4.3.6 Постоянные пользовательские данные","text":"Иногда вам может понадобится хранить какие то данные, которые будут использоваться между различными R сеансами. Например, я в своих пакетах таким образом храню авторизационные данные пользователя, для того, что бы пользователям моих пакетов не требовалось в ходе каждой новой R сессии проходить авторизацию через браузер, они один раз проходят весь процесс авторизации, полученные данные кешируются на жестком диске конечного пользователя, и во всех следующих сеансах читаются из кеша, что поволяет избегать повторной пользовательской авторизации.Конечно данные, которые будут использоваться между различными R сессиями необходимо хранить локально. на жестком диске пользователя пакета. При этом обязательно необходимо соблюдать спецификацию каталогов принятую для вашей операционной системы, для определения директорий в которых вы будете хранить файлы вашего пакета используйте функцию tools::R_user_dir():tools::R_user_dir(\"pkg\", = \"data\") – хранение данныхtools::R_user_dir(\"pkg\", = \"config\") – хранение конфиговtools::R_user_dir(\"pkg\", = \"cache\") – хранение кешированных данныхНо, следует учитывать что функция tools::R_user_dir() появилась в R 4.0, если вашему пакету необходимо иметь совместимость с более старыми версиями R, то в качестве альтернативного варианта используйте функционал пакета rappdirs, о котором я отдельно рассказывал в видео уроке \"Работа с секретными данными в R\".","code":""},{"path":"добавление-данных-в-пакет.html","id":"тест-2","chapter":"Урок 4 Добавление данных в пакет","heading":"4.4 Тест","text":"facebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""},{"path":"description---метаданные-пакета.html","id":"description---метаданные-пакета","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"Урок 5 DESCRIPTION - Метаданные пакета","text":"В этом видео мы с вами подробно разберёмся с содержимым одного из главных файлов в вашем пакете - DESCRIPTION, в котором хранятся его метаданные.Данный урок основан на главе \"DESCRIPTION\" книги \"R Packages (2e)\", под авторством Хедли Викхема и Дженни Брайан.","code":""},{"path":"description---метаданные-пакета.html","id":"видео-4","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.1 Видео","text":"","code":""},{"path":"description---метаданные-пакета.html","id":"тайм-коды-4","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.1.1 Тайм коды","text":"00:00 Вступление\n00:39 Назначение и минимальный пример файла DESCRIPTION\n01:53 Настройка дефолтных значений полей файла DESCRIPTION с помощью опции usethis.description\n03:04 Поля Title и Description\n04:09 Поле Authors@R для указания авторства пакета\n06:03 Поля URL и BugReports\n06:34 Поле License\n09:24 Поля Imports и Suggests\n12:30 Прочие поля файла DESCRIPTION\n14:20 Использование пользовательских полей в файле DESCRIPTION\n15:17 Заключение","code":""},{"path":"description---метаданные-пакета.html","id":"презентация-4","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.2 Презентация","text":"","code":""},{"path":"description---метаданные-пакета.html","id":"конспект-4","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3 Конспект","text":"Задача файла DESCRIPTION— хранить важные метаданные о вашем пакете. При создании пакета функцией usethis::create_package() в созданном проекте будет сразу добавлен минимальный пример файл DESCRIPTION.Во втором уроке курса я уже рассказывал о том, что вы можете задать дефолтные значения любых полей файла DESCRIPTION, для этого добавьте код определения опции usethis.description в файл .Rprofile.Далее подробно разберёмся все обязательные поля файла DESCRIPTION","code":"Package: package_name\nTitle: What the Package Does (One Line, Title Case)\nVersion: 0.0.0.9000\nAuthors@R: \n    person(\"Alexey\", \"Seleznev\", , \"selesnow@gmail.com\", role = c(\"aut\", \"cre\"),\n           comment = c(ORCID = \"0000-0003-0410-7385\"))\nDescription: What the package does (one paragraph).\nLicense: `use_mit_license()`, `use_gpl3_license()` or friends to pick a\n    license\nEncoding: UTF-8\nRoxygen: list(markdown = TRUE)\nRoxygenNote: 7.2.3\noptions(\n  usethis.description = list(\n    \"Authors@R\" = utils::person(\n        \"Jane\", \"Doe\",\n        email = \"jane@example.com\",\n        role = c(\"aut\", \"cre\"),\n        comment = c(ORCID = \"JANE'S-ORCID-ID\")\n    )\n  )\n)"},{"path":"description---метаданные-пакета.html","id":"title-и-description","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3.1 Title и Description","text":"Title представляет собой однострочное описание пакета и часто отображается в листинге пакета. Это должен быть обычный текст (без разметки), каждое слово должно начинаться с заглавной буквы, и НЕ заканчивающийся точкой. Будьте краткими: списки часто урезают заголовок до 65 символов.Description более подробное описание, чем заголовок. Вы можете использовать несколько предложений, но вы ограничены одним абзацем. Если ваше описание занимает несколько строк (а так и должно быть!), ширина каждой строки не должна превышать 80 символов. Отступ последующих строк с 4 пробелами.","code":""},{"path":"description---метаданные-пакета.html","id":"authorsr","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3.2 Authors@R","text":"Ранее для указания авторства использовались поля Author и Mainter, но сейчас более гибким способом является поле Authors@R, в которое вам необходимо перечислить авторов и сопровождающих вашего пакета с помощью функции utils::person().Аргументы функции utils::person():Имя, указанное первыми двумя аргументами given и family (обычно они задаются по положению, а не по имени).email, который является абсолютным требованием для сопровождающего. Важно отметить, что это адрес, который CRAN использует, чтобы сообщить вам, нужно ли исправить ваш пакет, чтобы остаться в CRAN.Один или несколько трехбуквенных кодов, определяющих расширение role. Вот самые важные роли, о которых нужно знать:\ncre: создатель или сопровождающий, человек, которого вы должны беспокоить, если у вас есть проблемы.\naut: авторы, внесшие значительный вклад в разработку пакета.\nctb: участники, те, кто внес меньший вклад, например патчи.\ncph: правообладатель. Это используется для перечисления дополнительных правообладателей, которые не являются авторами, как правило, компаний, таких как работодатель одного или нескольких авторов.\nfnd: спонсор, люди или организации, предоставившие финансовую поддержку для разработки пакета.\ncre: создатель или сопровождающий, человек, которого вы должны беспокоить, если у вас есть проблемы.aut: авторы, внесшие значительный вклад в разработку пакета.ctb: участники, те, кто внес меньший вклад, например патчи.cph: правообладатель. Это используется для перечисления дополнительных правообладателей, которые не являются авторами, как правило, компаний, таких как работодатель одного или нескольких авторов.fnd: спонсор, люди или организации, предоставившие финансовую поддержку для разработки пакета.","code":""},{"path":"description---метаданные-пакета.html","id":"url-и-bugreports","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3.3 URL и BugReports","text":"Поле URL обычно используется для рекламы веб-сайта пакета и для ссылки на общедоступный репозиторий исходных кодов, где происходит разработка.BugReports это URL-адрес, по которому следует отправлять отчеты об ошибках, например, как раздел issues GitHub.","code":""},{"path":"description---метаданные-пакета.html","id":"license","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3.4 License","text":"данное поле отвечает за тип лицензии вашего пакета, лицензия может регулировать законные права сторонних разработчиков на использование вашего кода, и в частности всего пакета в их собственных разработках или публикациях. Важно понимать, что это, по сути, машиночитаемое License поле, и не стоит заполнять его руками, для каждого типа лицензии в пакете usethis есть отдельная функция, которая заполняет поле License и добавляет в ваш пакет отдельный файл с описанием лицензии.use_mit_license() – если вам нужна лицензия, чтобы люди могли использовать ваш код с минимальными ограничениямиuse_gpl_license() - если вам нужна лицензия с авторским левом, чтобы все производные и пакеты вашего кода также имели открытый исходный кодuse_cc0_license() - если ваш пакет в основном содержит данные, а не код, и вам нужны минимальные ограниченияuse_ccby_license() – если ваш пакет содержит только данные, но вы хотите указания вашего авторстваuse_proprietary_license() - если вы не хотите делать свой код открытым (На CRAN не пустят)","code":""},{"path":"description---метаданные-пакета.html","id":"imports-suggests-depends","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3.5 Imports, Suggests, Depends","text":"Пакеты, перечисленные в, Imports необходимы вашим пользователям во время выполнения и будут установлены (или потенциально обновлены), когда пользователи установят ваш пакет через install.packages().Пакеты, перечисленные в, Suggests либо необходимы для задач разработки, либо могут разблокировать дополнительные возможности пакета для ваших пользователей.Для добавления необходимых пакетов в зависимости, т.е. в поля Imports или Description используйте функцию usethis::use_package().Так же вы можете использовать аргумент min_version для указания минимальной или текущей версии пакета, от которого щависит ваш пакет:","code":"\nusethis::use_package(\"dplyr\") # Default is \"Imports\"\n#> ✔ Adding 'dplyr' to Imports field in DESCRIPTION\n#> • Refer to functions with `dplyr::fun()`\n\nusethis::use_package(\"ggplot2\", \"Suggests\")\n#> ✔ Adding 'ggplot2' to Suggests field in DESCRIPTION\n#> • Use `requireNamespace(\"ggplot2\", quietly = TRUE)` to test if package is installed\n#> • Then directly refer to functions with `ggplot2::fun()`\n# exact version\nusethis::use_package(\"dplyr\", min_version = \"1.0.0\")\n\n# min version = currently installed version\nusethis::use_package(\"dplyr\", min_version = TRUE)"},{"path":"description---метаданные-пакета.html","id":"другие-поля","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3.6 Другие поля","text":"Выше я перечислил все обязательные поля файла DESCRIPTION, но вам также доступны некоторые другие поля:Version – Версия вашего пакета, удобный способ сообщить на какой версии разработки находится ваш пакет.LazyData – актуален если ваш пакет делает данные доступными для пользователя. Если вы укажете LazyData: true, наборы данных загружаются отложенно, что делает их более доступными, т. е. пользователям не нужно использовать data().Encoding – Описывает кодировку файлов вашего пакета.Collate - управляет порядком получения файлов R.VignetteBuilder - перечисляет любой пакет, который нужен вашему пакету в качестве механизма виньетирования.SystemRequirements - Здесь вы описываете зависимости, внешние по отношению к R. Это обычное текстовое поле, которое, например, фактически не устанавливает и не проверяет что-либо, поэтому вам может потребоваться включить дополнительные сведения об установке в файл README.","code":""},{"path":"description---метаданные-пакета.html","id":"пользовательские-поля","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.3.7 Пользовательские поля","text":"Существует также некоторая гибкость для создания собственных полей для добавления дополнительных метаданных. В самом узком смысле единственным ограничением является то, что вы не должны переназначать официальные имена полей, используемые R. Вы также должны ограничить себя допустимыми английскими словами, чтобы имена полей не помечались проверкой орфографии.На практике, если вы планируете отправлять в CRAN, мы рекомендуем, чтобы имя любого настраиваемого поля начиналось с Config/.","code":""},{"path":"description---метаданные-пакета.html","id":"тест-3","chapter":"Урок 5 DESCRIPTION - Метаданные пакета","heading":"5.4 Тест","text":"facebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""},{"path":"namespace---зависимости-пакета.html","id":"namespace---зависимости-пакета","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"Урок 6 NAMESPACE - Зависимости пакета","text":"Если вы в своём пакете используете функции из других пакетов, значит ваш пакет имеет зависимости. В этом уроке мы разберёмся с тем, как правильно организовать эти зависимости.Данный урок основан на главах \"Dependencies: Mindset Background\" и \"Dependencies: Practice\" книги \"R Packages (2e)\", под авторством Хедли Викхема и Дженни Брайан.","code":""},{"path":"namespace---зависимости-пакета.html","id":"видео-5","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.1 Видео","text":"","code":""},{"path":"namespace---зависимости-пакета.html","id":"тайм-коды-5","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.1.1 Тайм коды","text":"00:00 Вступление\n00:50 Преимущества и недостатки зависимостей\n02:41 Анализ зависимостей пакетов\n05:50 Какие компоненты пакета отвечают за его зависимости\n07:37 Файл NAMESPACE\n08:35 Рабочий процесс установки зависимостей\n14:56 Когда стоит импортировать объекты из других пакетов\n16:38 Как обращаться к функциям импортированным из других пакетов в коде, тестах и примерах вашего пакета, если поля указаны в поле Imports\n18:04 Как обращаться к функциям импортированным из других пакетов в коде вашего пакета, если поля указаны в поле Suggest\n21:34 Как обращаться к функциям импортированным из других пакетов в тестах вашего пакета, если поля указаны в поле Suggest\n23:10 Как обращаться к функциям импортированным из других пакетов в виньетках и примерах к функциям вашего пакета, если поля указаны в поле Suggest\n24:26 Как обращаться к функциям импортированным из других пакетов в коде, тестах и примерах вашего пакета, если поля указаны в поле Depends\n26:05 Импорт и экспорт S3 методов\n28:30 Заключение","code":""},{"path":"namespace---зависимости-пакета.html","id":"презентация-5","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.2 Презентация","text":"","code":""},{"path":"namespace---зависимости-пакета.html","id":"конспект-5","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3 Конспект","text":"Зависимости в вашем пакете появляются когда вы в коде своего пакета используете функции из сторонних пакетов.","code":""},{"path":"namespace---зависимости-пакета.html","id":"преимущества-и-недостатоки-зависимости","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.1 Преимущества и недостатоки зависимости","text":"Преимуществом является то, что экономите массу времени, на том, что используете чей то готовый код, который наверняка уже прошел определённое тестирование. Вам не придётся часть вспомогательного для вашего пакета функцила реализовывать самостоятельно, вы просто берёте нужные функции из дургого пакета, и используете в своём коде, так же как вы это делаете, когда пишите любой R скрипт.Но, за всё надо платить, поэтому в использовании зависимостей есть и ряд недостатоков:Ваш код становится чувствителен к изменениям в сторонних пакетах, и даже пакетов указанных в зависимостях используемыми вами пакетов.При установке вашего пакета, так же будут устанавливаться все пакеты от которых он зависит, что увеличивает занимаемое им место на жестком диске. Подавляющее большинство пакетов не занимают много места, но некторые могут весить более 100 мб.","code":""},{"path":"namespace---зависимости-пакета.html","id":"анализ-зависимостей-пакета","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.2 Анализ зависимостей пакета","text":"По началу у вас может сложиться мнение, что лучше вообще избавиться от всех зависимостей в своём пакете, но это не так, использование стороннего кода сократит вам очень много времени. Единственное - старайтесь использовать в зависимостях своего пакета низкоуровневые пакеты, у которых мало собственных зависимотей. Провести анализ зависимостей пакета можно с помощью пакета pak и функции pkg_deps_tree(), которая визуально отображает дерево зависимостей указанного пакета:Также вы можете использовать функцию tools::package_dependencies():Пакеты tidyverse и devtools являются не просто высокоуровневыми, они являются мета-пакетами, т.е. коллекциями из других пакетов, поэтому у них в зависомтях более 100 сторонних пакетов, в то время как у низкоуровневых rlang и cli всего 1 зависимость. Крайне изегайте использования в своих зависимостях мета-пакетов, при необходимости используйте нужный из коллекции пакет. Ниже пример, если вам необходимы функции из dplyr или tidyr, которые входят в tidyverse, то импортируйте именно конкретные пакеты, т.к. у них гораздо меньше зависимостей:","code":"\n# анализ зависимостей\n## просмотр дерева зависимостей\n### низкоуровневые пакеты\npak::pkg_deps_tree(\"tibble\")\n#> ℹ Loading metadata database\n#> ✔ Loading metadata database ... done\n#> \n#> tibble 3.2.1 [new][dl] (690.77 kB)\n#> ├─fansi 1.0.4 [new][dl] (312.84 kB)\n#> ├─lifecycle 1.0.3 [new][dl] (139.02 kB)\n#> │ ├─cli 3.6.1 [new][dl] (1.33 MB)\n#> │ ├─glue 1.6.2 [new][dl] (162.52 kB)\n#> │ └─rlang 1.1.1 [new][dl] (1.57 MB)\n#> ├─magrittr 2.0.3 [new][dl] (226.89 kB)\n#> ├─pillar 1.9.0 [new][dl] (659.28 kB)\n#> │ ├─cli\n#> │ ├─fansi\n#> │ ├─glue\n#> │ ├─lifecycle\n#> │ ├─rlang\n#> │ ├─utf8 1.2.3 [new][dl] (149.69 kB)\n#> │ └─vctrs 0.6.3 [new][dl] (1.33 MB)\n#> │   ├─cli\n#> │   ├─glue\n#> │   ├─lifecycle\n#> │   └─rlang\n#> ├─pkgconfig 2.0.3 [new][dl] (22.45 kB)\n#> ├─rlang\n#> └─vctrs\n#> \n#> Key:  [new] new | [dl] download\n## высокоуровневые пакеты\nn_hard_deps <- function(pkg) {\n  deps <- tools::package_dependencies(pkg, recursive = TRUE)\n  sapply(deps, length)\n}\n\nn_hard_deps(c(\"tidyverse\", \"devtools\", \"rlang\", \"cli\"))tidyverse  devtools     rlang       cli \n      114       101         1         1 \nn_hard_deps(c(\"dplyr\", \"tidyr\"))dplyr tidyr \n   20    26 "},{"path":"namespace---зависимости-пакета.html","id":"какие-компоненты-пакета-отвечают-за-зависимости","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.3 Какие компоненты пакета отвечают за зависимости","text":"Файл DESCRIPTION, позволяет указать какие пакеты будут установлены или рекомендованы к установке вместе с вашим пакетом:\nПоле Imports: указанные пакеты будут установлены вместе с вашим пакетом;\nПоле Suggest: указанные пакеты будут рекомендованы к установке;\nПоле Depends: указанные пакеты будут установлены и экспортированы вместе с вашим пакетом.\nПоле Imports: указанные пакеты будут установлены вместе с вашим пакетом;Поле Suggest: указанные пакеты будут рекомендованы к установке;Поле Depends: указанные пакеты будут установлены и экспортированы вместе с вашим пакетом.Файл NAMESPACE, управляет экспортом объектов в рабочее окружениеПакеты указанные в поле Imports файла DESCRIPTION не обязательно должны быть указаны в NAMESPACE, но все пакеты и функции перечисленные в файле NAMESPACE, так же обязательно должны быть указаны в полях Imports или Depends файла DESCRIPTION.","code":""},{"path":"namespace---зависимости-пакета.html","id":"директивы-файла-namespace","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.4 Директивы файла NAMESPACE","text":"Файл NAMESPACE зачустую выглядит примерно следующим образом:export(): экспортировать функцию (включая дженерики S3 и S4).S3method(): экспортировать метод S3.importFrom(): импортировать выбранный объект из другого пространства имен (включая дженерики S4).import(): импортировать все объекты из пространства имен другого пакета.useDynLib(): регистрирует процедуры из DLL (для пакетов с скомпилированным кодом).Есть ещё директива exportPattern(), которая экспортирует функции из вашего пакета по паттерну их имён с использованием регулярных выражений. Использовать эту жирективу не рекомендуется для избежания неожиданного экпорта.","code":"# Generated by roxygen2: do not edit by hand\n\nS3method(compare,character)\nS3method(print,testthat_results)\nexport(compare)\nexport(expect_equal)\nimport(rlang)\nimportFrom(brio,readLines)\nuseDynLib(testthat, .registration = TRUE)"},{"path":"namespace---зависимости-пакета.html","id":"рабочий-процесс","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.5 Рабочий процесс","text":"Весь рабочий процесс по добавлению зависимостей в пакет состоит из следующих этапов:Изначально добавляете с помощью команды usethis::use_package() необходимые пакеты в нужные поля файла DESCRIPTION.Над кодом функций используйте специальные roxygen комментарии import для импорта всего пространства имён стороннего пакета, или importFrom, для импорта отдельный функций из сторонних пакетов.Запускаете функцию devtools::document() для генерации файла NAMESPACE.Но, где удобнее всего прописать roxygen комментарии для импорта функций и целых пакетов, если вы их многократно используете в своём коде? Первое, что наверняка придёт вам в голову - писать roxygen комментарии для импорта над. каждой функцией, в которой используются импортируемые объекты. Но это слишком избыточно, ведь один roxygen комментарий уже добавит нужную директутиву в файл NAMESPACE, поэтому имеет смысл прописать все комментарии для импорта объектов в одном месте, для чего наиболее удобно использовать функцию usethis::usethis::use_package_doc(). Данная функция создаёт файл R/pkg-package.R, в котом и будут собираться все ваши roxygen комментари для импорта над пустым объектом NULL, выглядит этот файл примерно так:Далее вы будете добавлять в этот файл roxygen комментари с помощью use_import_from().","code":"\n#' @importFrom aaapkg aaa_fun\n#' @import bbbpkg\n#' @export\nfoo <- function(x, y, z) {\n  ...\n}\n# The following block is used by usethis to automatically manage\n# roxygen namespace tags. Modify with care!\n## usethis namespace: start\n#' @importFrom glue glue_collapse\n## usethis namespace: end\nNULL"},{"path":"namespace---зависимости-пакета.html","id":"когда-необходимо-экспортировать-объекты-из-сторонних-пакетов","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.6 Когда необходимо экспортировать объекты из сторонних пакетов","text":"В ходе курса я неоднократно говорил о том, что зачастую вам не потербуется экспортировать в рабочее окружение функции из стороних пакетов, а вместо этого просто пропишите все необходимые вам пакеты в поле Imports файла DESCRIPTION, а в коде ваших функций образайтесь к функциям импортированных пакетов с помощью package_name::function(). Но из этого правила есть некоторые исключения:Оператор: Вы не можете вызвать оператора из другого пакета через ::, поэтому его необходимо импортировать. Примеры: оператор объединения NULL %||% из rlang или пайплайн %>% из magrittr.Функция, которую вы часто используете. Если импорт функции делает ваш код более читабельным, это достаточная причина для ее импорта. Это буквально уменьшает количество символов, необходимых для вызова внешней функции.Функция, которую вы вызываете в жестком цикле с ::. Поиск объекта вызванного через два двоеточия составляет порядка 100 нс, поэтому оно будет иметь значение только в том случае, если вы вызываете функцию миллионы раз.","code":""},{"path":"namespace---зависимости-пакета.html","id":"как-обращаться-к-функциям-сторонних-пакетов","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.7 Как обращаться к функциям сторонних пакетов","text":"В зависимости от того как вы импортируете в свой пакет сторонние пакеты зависит то, как вы будете вызывать функции этих пакетов. На это влияет то, какие поля файла DESCRIPTION вы используете.","code":""},{"path":"namespace---зависимости-пакета.html","id":"при-импорте-пакетов-через-поле-imports","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.7.1 При импорте пакетов через поле Imports","text":"В коде пакета, т.е. в папке R/ обращайтесь к функциям из указанных в поле Imports пакетов package::function().В тестах обращайтесь к функциям из указанных в поле Imports пакетов package::function(). Но если вы импортировали определенную функцию отдельно или как часть всего пространства имен, вы можете просто вызвать ее непосредственно в тестовом коде.Если вы используете пакет, который указанный в Imports в одном из ваших примеров или виньеток, вам нужно будет либо прикрепить пакет с помощью, library(package) либо использовать package::function().","code":""},{"path":"namespace---зависимости-пакета.html","id":"при-импорте-пакетов-через-поле-suggest","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.7.2 При импорте пакетов через поле Suggest","text":"В отличае от поля Imports, пакеты указанные в поле Suggest не обязательно будут установлены у конечного пользователя вашего пакета, в связи с чем вам необходимо делать дополнительные проверки на наличие их установки.В коде пакета, т.е. в папке R/ вы должны проверить наличие установленного пакета с помощью базовой функции requireNamespace(), или функций из пакета rlang: is_installed() и check_installed().В тестах вы можете использовать функцию testthat::skip_if_not_installed() для пропуска тестов, если у пользовтаеля не установлены необходимые для их выполнения пакетов.Для использования пакетов указанных в Suggest в виньетках или примерах функций используйте функции require() или requireNamespace(), для проверки доступен ли необходимый пакет.","code":"\n# Проверка установки пакета через базовую requireNamespace()\n## Проверка установлен ли пакет\nmy_fun <- function(a, b) {\n  if (!requireNamespace(\"aaapkg\", quietly = TRUE)) {\n    stop(\n      \"Package \\\"aaapkg\\\" must be installed to use this function.\",\n      call. = FALSE\n    )\n  }\n  # code that includes calls such as aaapkg::aaa_fun()\n}\n\n# Альтрнативный сценарий выполнения\nmy_fun <- function(a, b) {\n  if (requireNamespace(\"aaapkg\", quietly = TRUE)) {\n    aaapkg::aaa_fun()\n  } else {\n    g()\n  }\n}\n\n\n# С помощью пакета rlang\n## пакет указанный в Suggest обязателен для выполнения функции\nmy_fun <- function(a, b) {\n  rlang::check_installed(\"aaapkg\", reason = \"to use `aaa_fun()`\")\n  # code that includes calls such as aaapkg::aaa_fun()\n}\n\n## Функция с двумя альтернативными сценариями\nmy_fun <- function(a, b) {\n  if (rlang::is_installed(\"aaapkg\")) {\n    aaapkg::aaa_fun()\n  } else {\n    g()\n  }\n}\ntest_that(\"basic plot builds without error\", {\n  skip_if_not_installed(\"sf\")\n\n  nc_tiny_coords <- matrix(\n    c(-81.473, -81.741, -81.67, -81.345, -81.266, -81.24, -81.473,\n      36.234, 36.392, 36.59, 36.573, 36.437, 36.365, 36.234),\n    ncol = 2\n  )\n\n  nc <- sf::st_as_sf(\n    data_frame(\n      NAME = \"ashe\",\n      geometry = sf::st_sfc(sf::st_polygon(list(nc_tiny_coords)), crs = 4326)\n    )\n  )\n\n  expect_doppelganger(\"sf-polygons\", ggplot(nc) + geom_sf() + coord_sf())\n})\n#' @examples\n#' if (require(\"maps\")) {\n#'   nz <- map_data(\"nz\")\n#'   # Prepare a map of NZ\n#'   nzmap <- ggplot(nz, aes(x = long, y = lat, group = group)) +\n#'     geom_polygon(fill = \"white\", colour = \"black\")\n#'\n#'   # Plot it in cartesian coordinates\n#'   nzmap\n#' }"},{"path":"namespace---зависимости-пакета.html","id":"при-импорте-пакетов-через-поле-depends","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.7.3 При импорте пакетов через поле Depends","text":"В этом случае рекомендации будут примерно теже, что и при использовании поля Imports, единственное, что при использовании поля Depends указанные в нём пакеты автоматически импортируются, и экспортируются в рабочее окружение, в связи с чем при использовании их в примерах функций и виньетках нет необходимости подключать их повторно командой library().","code":""},{"path":"namespace---зависимости-пакета.html","id":"импорт-и-экспорт-s3-методов","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.3.8 Импорт и экспорт S3 методов","text":"Экспортируете основную дженерик функцию через директиву export()Регистрируете её методы написанные под обработку объектов различных классов с помощью директивы S3method()Ниже пример дженерик функции и метода под обработку data.frame с её помощью:Для их экспорта прописываются следующие директивы в файле NAMESPACE:","code":"\n#' ... all the usual documentation for count() ...\n#' @export\ncount <- function(x, ..., wt = NULL, sort = FALSE, name = NULL) {\n  UseMethod(\"count\")\n}\n\n#' @export\ncount.data.frame <- function(\n  x,\n  ...,\n  wt = NULL,\n  sort = FALSE,\n  name = NULL,\n  .drop = group_by_drop_default(x)) { ... }...\nS3method(count,data.frame)\n...\nexport(count)\n..."},{"path":"namespace---зависимости-пакета.html","id":"тест-4","chapter":"Урок 6 NAMESPACE - Зависимости пакета","heading":"6.4 Тест","text":"facebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""},{"path":"новости-курса.html","id":"новости-курса","chapter":"Новости курса","heading":"Новости курса","text":"","code":""},{"path":"новости-курса.html","id":"section","chapter":"Новости курса","heading":"2023-09-012","text":"Опубликован шестой урок NAMESPACE - Зависимости пакета.","code":""},{"path":"новости-курса.html","id":"section-1","chapter":"Новости курса","heading":"2023-09-05","text":"Опубликован пятный урок DESCRIPTION - Метаданные пакета.","code":""},{"path":"новости-курса.html","id":"section-2","chapter":"Новости курса","heading":"2023-08-31","text":"В описание каждого урока добавлена информация о том, какой матриал лежит в его основе. Большая часть уроков курса основаны на книге \"R Packages (2e)\", под авторством Хедли Викхема и Дженни Брайан.","code":""},{"path":"новости-курса.html","id":"section-3","chapter":"Новости курса","heading":"2023-08-29","text":"Опубликован четвёртый урок курса Добавление данных в пакет","code":""},{"path":"новости-курса.html","id":"section-4","chapter":"Новости курса","heading":"2023-08-28","text":"В программу курса добавлен урок Разработка пакета обёртки для Google API (пакет gargle)\"\"","code":""},{"path":"новости-курса.html","id":"section-5","chapter":"Новости курса","heading":"2023-08-22","text":"Опубликован третий урок курса Рекомендации по организации R кода","code":""},{"path":"новости-курса.html","id":"section-6","chapter":"Новости курса","heading":"2023-08-16","text":"Доработана программа, урок по компонентам пакета был разбит на 2, организация кода в пакете и добавление данных в пакет","code":""},{"path":"новости-курса.html","id":"section-7","chapter":"Новости курса","heading":"2023-08-15","text":"Сформирована первая версия программы курсаОпубликован второй урок курса: Настройка системы и интеграция с GitHubНа страницы курса добавлены кнопки поделиться в социальных сетях и подписаться на telegram и youtube каналы","code":""},{"path":"новости-курса.html","id":"section-8","chapter":"Новости курса","heading":"2023-08-07","text":"Создан проект курсаВидео первого урока опубликовано на YouTubeСтраница первого урока добавлена в курс: Обзор рабочего процесса разработки пакетаКурс опубликован на selesnow.github.iofacebooklinkedintwitterwhatsappredditweiboinstagramtelegramtelegramyoutube","code":""}]
